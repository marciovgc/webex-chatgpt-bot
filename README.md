# Webex OpenAI ChatBot

This is a Python Flask application that acts as a middleware to use ChatGPT within Webex.
ItÂ´s main function is to build a Q&A ChatBot.

## Prerequisites

- Python 3.x
- Flask library
- OpenAI library
- ngrok service
- Webex bot

## Installation

1. Install Python:

   - Visit the official Python website at [python.org](https://www.python.org).
   - Download the latest version of Python 3.x for your operating system.
   - Run the installer and follow the instructions to install Python.

2. Clone the repository:

```
git clone <repository-url>
```

3. Create and activate a virtual environment (optional but recommended):

   - Open a terminal or command prompt.
   - Navigate to the project directory.
   - Run the following command to create a virtual environment:

     ```
     python -m venv venv
     ```

   - Activate the virtual environment:

     - For Windows:

       ```
       venv\Scripts\activate
       ```

     - For macOS/Linux:

       ```
       source venv/bin/activate
       ```

4. Install the required libraries:

```
pip install flask openai
```

5. Set up the OpenAI API credentials:

   - Sign up for an account on the OpenAI website at [openai.com](https://openai.com).
   - Generate an API key for your account.
   - Set the `OPENAI_API_KEY` environment variable to your API key.

6. Set up the Webex API credentials:

   - Go to the [Webex for Developers](https://developer.webex.com/) website and sign in with your Webex account.
   - Navigate to the [Webex for Developers Apps](https://developer.webex.com/my-apps) page.
   - Click on the "Create a New App" button.
   - Fill in the required information for your app, such as the name and description.
   - Choose the "Bot" option for the app type.
   - Once your app is created, you will receive a bot token. Set the `OPENAI_WEBEX_BOT_TOKEN` environment variable to your bot token.

7. Expose the application to the internet using ngrok:

   - Download and install ngrok from the official website: [ngrok.com](https://ngrok.com).
   - Run the following command to expose port 5005:

     ```
     ngrok http 5005
     ```

   - Note the URL generated by ngrok (e.g., `http://abcdefg.ngrok.io`). This URL will be used to access the application from the internet.

8. Update the Webex bot webhook:

   - Go back to your Webex developer page [Webex for Developers Apps](https://developer.webex.com).
   - Create the Bot Webhook URL using this link: https://developer.webex.com/docs/api/v1/webhooks/create-a-webhook
   - Use your bot authentication token.
   - Enter the ngrok generated URL (e.g., `http://abcdefg.ngrok.io`) as the "Target URL".
   - Give it a name and set the parameters "resource" and "event" to "all".
   - Save the changes.

## Usage

1. Start the Flask application:

```
python openai_chatbot.py
```

2. The application will run on `http://localhost:5005`.

3. Access the application from the internet using the ngrok URL:

```
http://abcdefg.ngrok.io
```

## How it works

This application uses the Flask framework, which is a lightweight web framework for Python. Flask allows you to create web applications easily and efficiently.

Here's how Flask works in this chatbot application:

1. The user asks a question by sending a message to the Webex Bot.
   
2. When a POST request is made to the root endpoint (`/`), the `index` function is triggered.

3. Flask routes the incoming request to the corresponding function based on the specified route (`/` in this case).

4. The `index` function retrieves the incoming message data from the Webex API.

5. It checks if the message is sent by the bot itself. If so, it ignores the message.

6. If the message is from a user, it extracts the message text and the room ID.

7. It uses the OpenAI API to generate a response based on the user's message using the GPT-3.5 model.

   - The OpenAI API provides powerful language models that can generate human-like text based on the given input.
   - In this application, the `client.chat.completions.create` method is used to generate the response.
   - The `model` parameter specifies the GPT-3.5 model to use.
   - The `messages` parameter is a list containing the conversation history, where each message has a `role` (either "user" or "assistant") and `content` (the text of the message).
   - The `temperature` parameter controls the randomness of the generated text. Higher values (e.g., 1.0) make the output more random, while lower values (e.g., 0.2) make it more deterministic.
   - The `n` parameter specifies the number of different completions to generate.
   - The `max_tokens` parameter limits the length of the generated response.

8. The generated reply is sent back to the Webex Bot as a response to the user's message.

## License

Feel free to modify and use this code according to your needs.

Please let me know if there's anything else you'd like to add or if you have any further questions!
